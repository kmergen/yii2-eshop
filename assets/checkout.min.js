"use strict";KMeshop.checkout=function(d){var e={init:function(e){d.extend(s,e),l=document.getElementById(s.CHECKOUT_FORM_ID),t=document.getElementById(s.PAYMENT_WALL_ID),m=Stripe(s.stripeId,{betas:["payment_intent_beta_3"]}),u=m.elements(),d(l).on("beforeSubmit",function(e){return a(r(),"submit"),!1}),d(t).on("show.bs.collapse",function(e){var n=d(e.target);n.find(".spinner-border").removeClass("d-none"),d.ajax(n.data("paneurl")).done(function(e){n.find(".spinner-border").addClass("d-none"),n.children(s.PANE_CONTENT_SELECTOR).html(e.html);var t=n.data("paymentmethod");o(t),a(t,"add",e),d(l).yiiActiveForm("validateAttribute","checkoutform-paymentmethod")}).fail(function(){})}),d(t).on("hide.bs.collapse",function(e){var t=d(e.target);t.parent().find("input").prop("checked",!1);var n=r();o(""),a(n,"remove"),t.children(s.PANE_CONTENT_SELECTOR).empty()}),d(document.getElementById(s.CANCEL_BUTTON_ID)).on("click",function(){document.getElementById(s.CHECKOUT_CANCELED_ID).value="1",l.submit()})}},c=new FloatLabels("form",{style:2}),s={active:!0,CHECKOUT_FORM_ID:"checkoutForm",PAYMENT_WALL_ID:"paymentWall",PAY_BUTTON_ID:"btnPay",CANCEL_BUTTON_ID:"btnCancel",CHECKOUT_CANCELED_ID:"checkoutform-checkoutcanceled",PAYMENT_METHOD_ID:"checkoutform-paymentmethod",PANE_CONTENT_SELECTOR:".card-body",stripeId:void 0},l=void 0,t=void 0,m=void 0,u=void 0,v=void 0,p=void 0;function a(e,t,n){switch(e){case"paypal_rest":"add"===t||"remove"===t||"submit"===t&&l.submit();break;case"stripe_card":"add"===t?(c.rebuild(),function(){void 0===p&&(p=u.create("card",{style:{base:{fontSize:"16px",color:"#32325d"}}}));p.mount("#stripeCardElement");var e=document.getElementById(s.PAY_BUTTON_ID);d(e).on("click",function(e){var t=document.getElementById("card-cardholdername"),n=document.getElementById("stripeClientSecret").value;m.handleCardPayment(n,p,{source_data:{owner:{name:t.value}}}).then(function(e){if(e.error);else;})}),p.addEventListener("change",function(e){var t=document.getElementById("stripeCardFormGroup"),n=document.getElementById("stripeCardErrors");e.error?(n.textContent=e.error.message,t.classList.add("is-invalid"),e.complete||t.classList.remove("is-valid")):(n.textContent="",t.classList.remove("is-invalid"),e.complete&&t.classList.add("is-valid"))})}(),i=n.errorMessages,d(l).yiiActiveForm("add",{id:"card-cardholdername",name:"Card[cardHolderName]",container:".field-card-cardholdername",input:"#card-cardholdername",error:".invalid-feedback",validateOnBlur:!1,validate:function(e,t,n,a,r){yii.validation.required(t,n,{message:i.cardHolderName.required})}})):"remove"===t&&(r=document.getElementById(s.PAY_BUTTON_ID),d(r).off("click"),p.unmount());break;case"stripe_sepa":"add"===t?(c.rebuild(),function(){void 0===v&&(v=u.create("iban",{style:{base:{color:"#32325d",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"},":-webkit-autofill":{color:"#32325d"}},invalid:{color:"#fa755a",iconColor:"#fa755a",":-webkit-autofill":{color:"#fa755a"}}},supportedCountries:["SEPA"]}));v.mount("#stripeIbanElement"),v.on("change",function(e){var t=document.getElementById("stripeIbanFormGroup"),n=document.getElementById("stripeIbanErrors"),a=document.getElementById("stripeBankName");e.error?(n.textContent=e.error.message,t.classList.add("is-invalid"),e.complete||t.classList.remove("is-valid")):(n.textContent="",t.classList.remove("is-invalid"),e.complete&&t.classList.add("is-valid")),e.bankName?(a.textContent=e.bankName,a.classList.add("d-block")):(a.classList.remove("d-block"),a.classList.add("d-none"))})}(),o=n.errorMessages,d(l).yiiActiveForm("add",{id:"sepa-bankaccountowner",name:"Sepa[bankaccountOwner]",container:".field-sepa-bankaccountowner",input:"#sepa-bankaccountowner",error:".invalid-feedback",validateOnBlur:!1,validate:function(e,t,n,a,r){yii.validation.required(t,n,{message:o.bankaccountOwner.required})}})):"remove"===t?v.unmount():"submit"===t&&(a={type:"sepa_debit",currency:"eur",owner:{name:document.querySelector('input[name="Sepa[bankaccountOwner]"]').value,email:"klaus.mergen@web.de"},mandate:{notification_method:"email"}},m.createSource(v,a).then(function(e){var t,n,a=document.getElementById("stripeIbanFormGroup"),r=document.getElementById("stripeIbanErrors");e.error?(r.textContent=e.error.message,a.classList.add("is-invalid")):(a.classList.remove("is-invalid"),t=e.source,(n=document.createElement("input")).setAttribute("type","hidden"),n.setAttribute("name","stripeSource"),n.setAttribute("value",t.id),l.appendChild(n))}));break;default:return}var a,o,r,i}function r(){return document.getElementById(s.PAYMENT_METHOD_ID).value}function o(e){document.getElementById(s.PAYMENT_METHOD_ID).value=e}return e}(jQuery);